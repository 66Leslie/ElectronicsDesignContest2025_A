# 调试配置使用说明

## 概述
所有调试相关的宏定义现在都集中在 `Core/user/debug_config.h` 文件中，提供了统一的调试输出管理。

## 文件结构

### debug_config.h
```
Core/user/debug_config.h
├── 调试总开关
├── 模块调试开关
├── 调试级别控制
├── 调试宏定义
│   ├── 主程序调试宏
│   ├── 用户调节器调试宏
│   ├── 三相PWM调试宏
│   └── PLL调试宏
├── 兼容性定义
└── 使用示例
```

## 调试控制

### 1. 全局控制
```c
#define GLOBAL_DEBUG_ENABLE 1  // 1=启用所有调试, 0=禁用所有调试
```

### 2. 模块控制
```c
#define USER_MAIN_DEBUG 1           // 主程序调试
#define USER_REGULATOR_DEBUG 1      // 用户调节器调试
#define THREE_PHASE_PWM_DEBUG 1     // 三相PWM调试
#define PLL_DEBUG 1                 // PLL调试
```

### 3. 级别控制
```c
#define DEBUG_LEVEL_ERROR   1   // 错误信息
#define DEBUG_LEVEL_INFO    2   // 一般信息
#define DEBUG_LEVEL_DEBUG   3   // 详细调试信息

#define CURRENT_DEBUG_LEVEL DEBUG_LEVEL_INFO  // 当前级别
```

## 调试宏使用

### 主程序调试
```c
user_main_printf("普通输出");
user_main_info("系统启动完成");
user_main_debug("时钟频率: %d MHz", 170);
user_main_error("系统错误: %d", error_code);
```

### 用户调节器调试
```c
user_regulator_printf("普通输出");
user_regulator_info("控制器初始化完成");
user_regulator_debug("调制比: %.1f%%", ratio * 100.0f);
user_regulator_error("控制器错误: %d", error_code);
```

### 三相PWM调试
```c
three_phase_printf("普通输出");
three_phase_info("三相PWM启动");
three_phase_debug("A相占空比: %d", duty_cycle);
three_phase_error("PWM错误: %d", error_code);
```

### PLL调试
```c
pll_printf("普通输出");
pll_info("PLL锁定成功");
pll_debug("相位误差: %.2f°", phase_error);
pll_error("PLL错误: %d", error_code);
```

## 输出格式

### 格式说明
```
[<TAB><模块名>]<级别>:<消息内容>
```

### 输出示例
```
[	main]info:系统启动完成
[	regulator]debug:调制比: 50.0%
[	3phase]info:三相PWM启动
[	pll]error:锁相失败
```

## 使用场景

### 1. 开发阶段
```c
// 启用所有调试信息
#define GLOBAL_DEBUG_ENABLE 1
#define USER_REGULATOR_DEBUG 1
#define THREE_PHASE_PWM_DEBUG 1
#define PLL_DEBUG 1
```

### 2. 测试阶段
```c
// 只启用关键信息
#define GLOBAL_DEBUG_ENABLE 1
#define USER_REGULATOR_DEBUG 1
#define THREE_PHASE_PWM_DEBUG 0  // 关闭详细PWM调试
#define PLL_DEBUG 0              // 关闭PLL调试
```

### 3. 发布版本
```c
// 关闭所有调试
#define GLOBAL_DEBUG_ENABLE 0
```

### 4. 故障排查
```c
// 只启用特定模块
#define GLOBAL_DEBUG_ENABLE 1
#define USER_REGULATOR_DEBUG 0
#define THREE_PHASE_PWM_DEBUG 1  // 只调试三相PWM
#define PLL_DEBUG 0
```

## 优势

1. **集中管理**: 所有调试宏都在一个文件中
2. **易于配置**: 修改一个文件就能控制所有调试输出
3. **模块化**: 可以单独控制每个模块的调试
4. **格式统一**: 所有输出都有统一的格式
5. **性能优化**: 可以完全禁用调试以提高性能

## 注意事项

1. **包含顺序**: 确保在使用调试宏之前包含 `debug_config.h`
2. **编译优化**: 禁用调试时，宏会被编译器优化掉，不影响性能
3. **UART带宽**: 大量调试输出可能影响系统实时性
4. **内存使用**: 调试字符串会占用Flash空间

## 扩展建议

1. **时间戳**: 可以在宏中添加时间戳
2. **文件输出**: 可以将调试信息输出到文件
3. **网络输出**: 可以通过网络发送调试信息
4. **颜色输出**: 可以为不同级别添加颜色

## 快速参考

### 常用配置
```c
// 开发模式 - 所有调试
#define GLOBAL_DEBUG_ENABLE 1

// 测试模式 - 关键调试
#define THREE_PHASE_PWM_DEBUG 0
#define PLL_DEBUG 0

// 发布模式 - 无调试
#define GLOBAL_DEBUG_ENABLE 0
```

### 常用宏
```c
three_phase_info("信息");
three_phase_debug("调试: %d", value);
three_phase_error("错误: %s", error_msg);
```
